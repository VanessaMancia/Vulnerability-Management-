## The main goal of vulnerability management is to mitigate risk to what your organization deems acceptable. 
![White Modern Simple Travel YouTube Channel Art (1)](https://github.com/VanessaMancia/Vulnerability-Management-/assets/112146207/c92fea58-1097-4fdb-a0be-994b4c17c926)

## In this lab, we will use OpenVAS, an open-source vulnerability tool, to scan a vulnerable Windows VM. We will do a credentialed and uncredentialed scan of the affected host machine to see the differences between both of these scans. 


# Phase 1 - Setting up our Scanner in Azure 

## The First thing we will do is go to portal.azure.com once we are there we will search for "marketplace" and once we are in the marketplace search "OpenVAS" > OpenVAS secured and supported by HOSSTED 

<img src="https://github.com/VanessaMancia/Vulnerability-Management-/assets/112146207/967f721e-054a-45bb-914c-ff86951c49af.png" width=40% height=40%>

## > Start with a pre-set configuration > Dev/Test

<img src="https://github.com/VanessaMancia/Vulnerability-Management-/assets/112146207/ad2af267-5463-413a-9027-34a41fc04f14.png" width=40% height=40%>

## Now we will create our VM with the following:
### Resource group: Vulnerability-Management 
### VM Name: OpenVAS in the region of East US 2
### Authentication with password 
### Monitor: Disable boot diagnostics 

## Once we hit "create" we can go to the search bar and type in "VM" or go to resources 

<img src="https://github.com/VanessaMancia/Vulnerability-Management-/assets/112146207/71c2c999-408c-41e1-a073-333f3b0783f4.png" width=40% height=40%>

## Now that we have finished our OpenVAS VM we will SSH with it using Powershell since I am on a Windows computer. If you are on a Mac you can use Terminal to SSH into your VM. Remember we will SSH into our VM with the credentials we created earlier for our OpenVAS VM.

### Click on your VM and copy the public IP address to SSH.
###### ssh (your username) @ (your public IP address) 

<img src="https://github.com/VanessaMancia/Vulnerability-Management-/assets/112146207/845afe47-2606-448b-a557-8a6126853b22.png" width=60% height=60%>

## Take note of the URL which you will open up in a new tab and the username and password that will be used to log into the OpenVAS website
###### Sometimes that password may not work so you can try admin as a password

<img src="https://github.com/VanessaMancia/Vulnerability-Management-/assets/112146207/67a3c229-e528-43fb-b0e5-656b3c0fec9e.png" width=35% height=35%>

---
# Phase 2 - Create Client VM and make it vulnerable 

## Go back to portal.azure.com and we will create our vulnerable Windows 10 VM with the following:

### Resource group: Vulnerability-Management 
### VM Name: Win10-Vulnerable in the region of East US 2
### Image: Windows 10 Pro
### Size: Any size with 2 vCPUs
### Username & Password
###  Networking: Same Vnet as OpenVAS

## Now that Win10-Vulnerable is created we need to RDP into it with the credentials we just created. On Windows we use remote desktop connection and on Mac, you will have to download it from the app store. 

## We can go to our Azure portal type in "VM" and click on the Windows 10 Vulnerable and we will copy and paste our Public IP address to RDP and this is what it should look like 

<img src="https://github.com/VanessaMancia/Vulnerability-Management-/assets/112146207/f23dd17f-4934-482c-9ffa-15f871c2752e.png" width=50% height=50%>

<img src="https://github.com/VanessaMancia/Vulnerability-Management-/assets/112146207/5f9960e6-5a18-4e9d-b5c9-6ed5b62fe760.png" width=50% height=50%>

## Now that we are inside our Windows 10 VM we are going to make it vulnerable by disabling the Windows Firewall & installing old software.

### wf.msc and disable the firewall settings 
<img src="https://github.com/VanessaMancia/Vulnerability-Management-/assets/112146207/bc4c6a21-aaed-4077-801c-b884ae4ad203.pmg" width=50% height=50%> 

## I'm going to install the following old software on my Windows 10 and then reboot the VM 

<img src="https://github.com/VanessaMancia/Vulnerability-Management-/assets/112146207/1680e1f3-18d0-41d2-a89c-c784b884f6da.png" width=50% height=50%>

---
# Phase 3 - Configure OpenVAS to perform the first unauthenticated scan against our vulnerable VM  

## Login to OpenVAS > Assets > Hosts > New Host
### For scans we don't want to scan over the internet as it will make things slow so that is why we are using the private IP address 

## We will create a new target from the host and name it "Azure Vulnerable VMs." Now we will create a task that will conduct the scan. Go to Scans > Tasks > New Task 

<img src="https://github.com/VanessaMancia/Vulnerability-Management-/assets/112146207/fd3a378c-b319-45e0-8285-bd9c9f9d347b.png" width=50% height=50%>

## The scan is now finished. As we can tell, none of the old software we downloaded in our vulnerable VM displays in the results. The reason is that this was an unauthenticated scan meaning it will only take a look superficially unlike a credentialed scan which dives deeper. 

<img src="https://github.com/VanessaMancia/OpenVas_Management_Lab/assets/112146207/52f5f2ea-96bd-4250-bd4e-1c1f03c9ea83.png" width=80% height=80%> 

## Phase 4 - Make Configurations for Credentialed Scans (Within VM)

### We are going to RDP into our Windows VM and disable user account control (UAC). What user account control (UAC) does is reduce the risk of malware by limiting the ability of malicious code to execute with admin privileges. Since we are disabling UAC it means the operating system won't prompt users for permission when making changes that require admin privileges. 

<img src="https://github.com/VanessaMancia/Vulnerability-Management-/assets/112146207/179e6bdb-388c-41c5-9ab0-78596eb36553.png" width=50% height=60%>

### Now we will enable remote registry by typing services.msc and change it from disabled to automatic. Now that we changed it to automatic it means that remote users can modify the Windows registry. The Windows registry if compromised by a threat can lead to serious security issues such as unauthorized changes, malware injection, privilege escalation and data leakage. 

<img src="https://github.com/VanessaMancia/Vulnerability-Management-/assets/112146207/57c05497-0133-4fff-9a0a-f6b450cd5097.png" width=40% height=40%>

<img src="https://github.com/VanessaMancia/Vulnerability-Management-/assets/112146207/314d8906-9cc1-4afe-8972-c71ace356454.png" width=40% height=40%>

### We will set the registry key by searching Registry Editor. Now navigate to HKEY_LOCAL_MACHINE hive > Software\Microsoft\Windows\CurrentVersion\Policies\System - Inside of system we will create a DWORD named: LocalAccountTokenFilterPolicy and set the value to 1 > close the registry > restart 

<img src="https://github.com/VanessaMancia/OpenVas_Management_Lab/assets/112146207/302213ab-d5e8-406a-89a3-832b4723747c.png" width=40% height=40%>

## Phase 5 - Make Configurations for credentialed Scans (OpenVAS)

### Now we will go back to OpenVAS Web App. Once logged in go to Configuration > Credentials > New Credential

<img src="https://github.com/VanessaMancia/OpenVas_Management_Lab/assets/112146207/574cd5d4-3151-4a17-b259-018b4f6091fd.png" width=50% height=50%>


### We will now clone the target we did before by following these steps Go to Configuration > Targets > CLONE the Target

## Phase 6 - Execute Credentialed Scan Against our Vulnerable Windows VM

### Go to Scans > Tasks and fill the rest out as you see below 


<img src="https://github.com/VanessaMancia/OpenVas_Management_Lab/assets/112146207/0d640b38-02ba-41e2-ae6e-245be92f67c9.png" width=50% height=50%>

### Click the Play button to launch the new Credentialed Scan, and wait for it to finish. It will take longer than the last one.


### After the credentialed scan finishes, you can immediately see the difference in findings:

<img src="https://github.com/VanessaMancia/OpenVas_Management_Lab/assets/112146207/3c0f94b4-72bc-4820-9cf1-5ff5c1c9e5e4.png" width=80% height=80%>

<img src="https://github.com/VanessaMancia/OpenVas_Management_Lab/assets/112146207/d55121c8-7b37-463d-900e-dc8ddf7a39ac.png" width=80% height=80%>

